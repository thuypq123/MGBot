name: Docker Image CI
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag thuypq123/mg_bot:v1.0.0
    - name: Login to GHCR 
      uses: docker/login-action@v1
      with:
        registry: ghcr.io
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        ecr: auto
        logout: true
    - name: Check Docker login status
      run: |
        echo "Logging into ghcr.io..."
        if ! docker login ghcr.io -u thuypq123 -p ${{ secrets.DOCKER_PASSWORD }}; then
          echo "Error: Error response from daemon: Get \"https://ghcr.io/v2/\": denied: denied"
          exit 1
        fi
        echo "Logged into ghcr.io"
    - name: Pull the Docker image
      run: docker pull thuypq123/mg_bot:v1.0.0
    - name: Success
      run: echo "Success"